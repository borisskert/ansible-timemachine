---
- hosts: test_machine
  become: yes

  roles:
    - role: install-docker
      storage_driver: overlay2
      cleanup_enabled: no
      install_pip_docker: yes

    - role: ansible-timemachine
      server_name: My Time Machine
      storage_volume: /srv/docker/timemachine/storage
      config_volume: /srv/docker/timemachine/config
      data_volume: /srv/docker/timemachine/data
      lock_volume: /srv/docker/timemachine/lock
      interface: 0.0.0.0
      netatalk_port: 548
      log_level: error
      users:
        - username: user1
          password: psw1
          uid: 2001
        - username: user2
          password: psw2
          uid: 2002
      storages:
        - name: Time Machine user1
          path: storage1
          user: user1
          size_limit: 262144000
        - name: Time Machine user2
          path: storage2
          user: user2
          size_limit: 131072000

    - role: install-avahi
      published_services:
        - name: timemachine
          services:
            - type: _afpovertcp._tcp
              port: 548
            - type: _device-info._tcp
              port: 0
              txt_records:
                - model=TimeCapsule
