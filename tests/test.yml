---
- hosts: test_machine
  become: yes

  roles:
    - role: install-docker
      storage_driver: overlay2
      cleanup_enabled: no
      install_pip_docker: yes

    - role: ansible-timemachine
      alpine_version: 3.11.5
      netatalk_version: 3.1.12-r1
      host_name: my-ansible-timemachine
      mimic_model: RackMac
      server_name: My Time Machine
      storage_volume: /srv/timemachine/storage
      config_volume: /srv/timemachine/config
      interface: 0.0.0.0
      netatalk_port: 548
      log_level: error
      users:
        - username: user1
          password: user1pwd
          uid: 2001
        - username: user2
          password: psw2
          uid: 2002
      storages:
        - name: Time Machine user1
          path: storage1
          user: user1
          size_limit: 256000
        - name: Time Machine user2
          path: storage2
          user: user2
          size_limit: 64000

    - role: install-avahi
      published_services:
        - name: '%h'
          file: timemachine
          services:
            - type: _afpovertcp._tcp
              port: 548
            - type: _device-info._tcp
              port: 0
              txt_records:
                - model=TimeCapsule
            - type: _adisk._tcp
              port: 9
              txt_records:
                - sys=waMa=0,adVF=0x100,adVU=00000000-AAAA-BBBB-CCCC-111111111111
                - dk0=adVN=Time Machine user1,adVF=0x81
                - dk1=adVN=Time Machine user2,adVF=0x81
